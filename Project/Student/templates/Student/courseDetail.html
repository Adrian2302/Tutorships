<!DOCTYPE html>
{% load static %}
<html>
   <head>
        {% include "baseHead.html" %}
        <link rel="stylesheet" href="{% static 'fullcalendar/lib/main.css' %}">
    </head>
 
    <body>
    
        {% include "studentHeader.html" %}

        </br>
        
        {% include "filters.html" %}
        
        <div class="container mt-2">
            <form method = "POST">
                {% csrf_token %}
                <div class="container-fluid mt-4">
                    <div class="container">
                        <select name="tutor"class="selectpicker form-control messagelist" id="select_tutor" title="Seleccione el tutor">
                            {% for tutor in tutors %}
                                <option value="{{tutor.email}}">{{tutor.name}}  {{tutor.lastname}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <input type="submit" value="Submit" id="submit_tutor" hidden>
            </form>

            </br>

            <h3> Calendarios de {{calendar_title}}</h3>
            <div id="calendar"></div>
            
            <form action="{% url 'request_tutorship' course_name=course %}" method="GET" id="form_report">
                <input type="hidden" name="schedule_number" id="schedule">
            </form>

            <div class="modal fade" id="modal_tutorship" tabindex="-1" role="dialog" aria-labelledby="modalTutorshipLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="example_modal_label">Agendar tutoria</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        
                    </div>
                </div>
            </div>
        </div>
    </body>

    <script src="{% static 'fullcalendar/lib/main.js' %}"></script>
    <script src="{% static 'fullcalendar/lib/locales/es.js' %}"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function(){

            $('#select_tutor').on('change', function(){
                document.getElementById("submit_tutor").click();
            });
   
            var calendarUI = document.getElementById('calendar')
            var calendar = new FullCalendar.Calendar(calendarUI, {
                locale: 'es',
                selectable: false,
                selectMirror: false,
                eventClick: function(arg) {
                    document.getElementById("schedule").value = arg.event.id;
                    document.getElementById("form_report").submit();   
                },
                editable: true,
                nextDayThreshold: '00:00',
                displayEventTime: false,
                events: [
                    {% for event in events %}
                        {
                            title: '{{event.message}}',
                            start: '{{event.start}}',
                            end: '{{event.end}}',
                            id: '{{event.id}}',
                        },
                    {% endfor %}
                ]
            });
            calendar.render();
        });

    </script>
</html>